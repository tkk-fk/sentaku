<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ã˜ã¶ã‚“ã§ã€ãˆã‚‰ã¼ã†ï¼</title>
<!-- PWA åŸºæœ¬è¨­å®š -->
<meta name="theme-color" content="#111827" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<link rel="apple-touch-icon" href="icons/icon-180.png" />
<link rel="manifest" href="manifest.webmanifest" />
<style>
  :root{
    --bg:#ffffff; --fg:#0f172a; --muted:#e5e7eb;
    --card:#f8fafc; --btn:#111827; --btnfg:#ffffff;
    --gap:10px;
  }
  *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
  html,body{ height:100%; }
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family: system-ui,-apple-system,"Noto Sans JP","Hiragino Sans","Yu Gothic UI","Segoe UI",sans-serif;
    line-height:1.4; touch-action: manipulation;
    padding-left: env(safe-area-inset-left); padding-right: env(safe-area-inset-right);
    padding-bottom: env(safe-area-inset-bottom);
  }
  .app{ min-height:100dvh; min-height:100svh; display:flex; flex-direction:column; gap:8px; }

  header.panel{
    padding:calc(8px + env(safe-area-inset-top)) 12px 8px 12px;
    background:var(--card); border-bottom:1px solid var(--muted);
  }
  .row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  select, input[type="text"]{ font-size:16px; padding:10px 12px; border:1px solid var(--muted); border-radius:10px; background:#fff; }
  label.inline{ display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border:1px solid var(--muted); border-radius:999px; background:#fff; }
  button{ font-size:16px; padding:12px 16px; border-radius:12px; border:1px solid var(--muted); background:#fff; cursor:pointer; }
  button.ghost{ background:transparent; }
  button.primary{ background:var(--btn); color:var(--btnfg); border-color:var(--btn); }
  .hint{ font-size:12px; opacity:.7; }

  #editors{ margin-top:8px; display:grid; gap:8px; grid-template-columns: repeat(4,minmax(120px,1fr)); }
  #editors .colspan2{ grid-column: span 2; }
  #editors .colspan4{ grid-column: span 4; }
  .hidden{ display:none !important; }

  main#stage{ flex:1; display:grid; gap:var(--gap); padding:var(--gap); align-items:stretch; justify-items:stretch; }
  .two{ grid-template-columns: 1fr 1fr; grid-auto-rows: 1fr; }
  .three{ grid-template-columns: 1fr 1fr 1fr; grid-auto-rows: 1fr; }
  .four{ grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; grid-auto-rows: 1fr; }

  .choice{
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    border:2px solid var(--muted); border-radius:18px; background:#fff;
    font-size: clamp(22px, 6vw, 48px); font-weight:700; text-align:center;
    user-select:none; -webkit-user-select:none; min-height:110px; aspect-ratio: 1/1;
    padding:10px;
  }
  .choice .sub{ font-size: clamp(14px, 3.5vw, 22px); margin-top:6px; opacity:.85; }
  .blue{ background:#eff6ff; border-color:#bfdbfe; }
  .amber{ background:#fffbeb; border-color:#fde68a; }
  .green{ background:#ecfdf5; border-color:#bbf7d0; }
  .red{ background:#fef2f2; border-color:#fecaca; }
  .yellow{ background:#fefce8; border-color:#fde68a; }
  .choice:active{ transform: scale(.98); }

  /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
  #overlay{ position: fixed; inset:0; background: rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:20; padding:var(--gap); }
  #overlay .card{ background:#fff; padding:24px; border-radius:24px; width:min(92vw,680px); text-align:center; box-shadow:0 20px 50px rgba(0,0,0,.25); }
  #overlay .big{ font-size: clamp(40px, 10vw, 76px); font-weight:800; }
  #overlay .big .small{ display:block; font-size: clamp(16px, 4.2vw, 24px); opacity:.75; margin-top:6px; }
  #overlay .close{ margin-top:16px; padding:12px 16px; }

  /* ãƒ—ãƒ¬ã‚¼ãƒ³ï¼ˆæ“ä½œãƒ‘ãƒãƒ«éš ã—ï¼‹ãƒ­ãƒƒã‚¯ï¼‰ */
  .presentation header.panel{ display:none; }
  #unlockButton{
    position:fixed; left:calc(8px + env(safe-area-inset-left)); top:calc(8px + env(safe-area-inset-top)); z-index:31;
    font-size:15px; padding:8px 12px; border-radius:999px; border:1px solid var(--muted);
    background:#fff; opacity:0.9; cursor:pointer; display:none;
  }
  .presentation #unlockButton{ display:block; }

  #stage, .choice, #overlay{ overscroll-behavior: contain; }

  /* ===== ã‚¹ãƒãƒ›ç¸¦å‘ãï¼šå¹…ãŒç‹­ã„ã¨ãã®æœ€é©åŒ– ===== */
  @media (max-width: 480px){
    :root{ --gap:8px; }
    main#stage{ padding:var(--gap); }
    .choice{ font-size: clamp(20px, 6.5vw, 40px); min-height: 90px; }
    .three{ grid-template-columns: 1fr 1fr; }
    .three .choice:last-child{ grid-column: 1 / -1; }
  }

  /* ===== æ¨ªå‘ãã‚„å°ã•ãªé«˜ã•ã®ç”»é¢ ===== */
  @media (max-height: 480px){
    .choice{ font-size: clamp(18px, 6vh, 36px); min-height: 80px; }
    #overlay .big{ font-size: clamp(32px, 12vh, 60px); }
  }

  /* ===== ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆä»¥ä¸Š ===== */
  @media (min-width: 768px){
    .choice{ font-size: clamp(28px, 3.8vw, 56px); }
    #editors{ grid-template-columns: repeat(6, minmax(120px, 1fr)); }
  }
</style>
</head>
<body>
<div class="app" id="appRoot">
  <header class="panel" id="panel">
    <div class="row">
      <label class="inline">ãƒ‘ã‚¿ãƒ¼ãƒ³
        <select id="pattern">
          <option value="marubatsu">â­•ï¸ / âŒï¼ˆï¼’æŠï¼‰</option>
          <option value="yaru">ã‚„ã‚‹ï¼Ÿ / ã‚„ã‚‰ãªã„ï¼Ÿ / ã¡ã‚‡ã£ã¨ã‚„ã‚‹ï¼Ÿï¼ˆ3æŠï¼‰</option>
          <option value="one2four">ï¼‘ / ï¼’ / ï¼“ / ï¼”ï¼ˆ4æŠï¼‰</option>
        </select>
      </label>
      <button id="present" class="primary">å…¨ç”»é¢</button>
      <button id="installBtn" class="ghost" hidden>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</button>
    </div>

    <!-- ã‚¨ãƒ‡ã‚£ã‚¿ç¾¤ï¼šé¸æŠãƒ‘ã‚¿ãƒ¼ãƒ³ã«åˆã‚ã›ã¦æ´»ç”¨ -->
    <div id="editors">
      <!-- 2ã€œ3æŠç”¨ã‚¨ãƒ‡ã‚£ã‚¿ -->
      <div id="edit2" class="colspan4">
        <div class="colspan4 hint">é¸æŠè‚¢ã¯è‡ªç”±ç·¨é›†ã§ãã¾ã™ã€‚</div>
        <label>1 <input type="text" id="left2" placeholder="ä¾‹ï¼šâ­•ï¸ / ã‚„ã‚‹"></label>
        <label>2 <input type="text" id="right2" placeholder="ä¾‹ï¼šâŒ / ã‚„ã‚‰ãªã„"></label>
        <label id="thirdRow">3 <input type="text" id="third" placeholder="ä¾‹ï¼šã¡ã‚‡ã£ã¨ã‚„ã‚‹ï¼Ÿ"></label>
      </div>

      <!-- 4åˆ†å‰²ç”¨ã‚¨ãƒ‡ã‚£ã‚¿ -->
      <div id="edit4" class="colspan4 hidden">
        <div class="colspan4 hint">é¸æŠè‚¢ã¯è‡ªç”±ç·¨é›†ã§ãã¾ã™ã€‚</div>
        <label>1 <input type="text" id="t1" placeholder="ä¾‹ï¼šãŒã‚“ã°ã£ã¦ã‚„ã‚‹"></label>
        <label>2 <input type="text" id="t2" placeholder="ä¾‹ï¼š5åˆ†ãŸã£ãŸã‚‰ã‚„ã‚‹"></label>
        <label>3 <input type="text" id="t3" placeholder="ä¾‹ï¼šæœ€å¾Œã®5åˆ†ã ã‘ã‚„ã‚‹"></label>
        <label>4 <input type="text" id="t4" placeholder="ä¾‹ï¼šã‚ã„ã•ã¤ã ã‘ã‚„ã‚‹"></label>
      </div>
    </div>
  </header>

  <main id="stage" class="two" aria-live="polite" aria-label="é¸æŠã‚¨ãƒªã‚¢"></main>

  <button id="unlockButton" title="è¡¨ç¤ºã‚’å…ƒã«æˆ»ã™">ğŸ”“è§£é™¤</button>

  <div id="overlay" role="dialog" aria-modal="true">
    <div class="card">
      <div class="big" id="overlayText">â­•ï¸<span class="small"></span></div>
      <button class="close" id="overlayClose">ã¨ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
(() => {
  const $ = sel => document.querySelector(sel);

  const state = {
    pattern: 'marubatsu',
    labels2: {
      marubatsu: ['â­•ï¸','âŒ'],
      yaru: ['ã‚„ã‚‹','ã‚„ã‚‰ãªã„','ã¡ã‚‡ã£ã¨ã‚„ã‚‹ï¼Ÿ']
    },
    labels4: ["","","",""]
  };

  const stage = $('#stage');
  const patternSel = $('#pattern');
  const presentBtn = $('#present');
  const overlay = $('#overlay');
  const overlayText = $('#overlayText');
  const overlayClose = $('#overlayClose');
  const unlockBtn = $('#unlockButton');
  const installBtn = $('#installBtn');

  const edit2 = $('#edit2');
  const edit4 = $('#edit4');
  const thirdRow = $('#thirdRow');

  const left2 = $('#left2');
  const right2 = $('#right2');
  const third = $('#third');
  const tInputs = [$('#t1'), $('#t2'), $('#t3'), $('#t4')];

  const save = () => localStorage.setItem('selectAid:v9', JSON.stringify(state));
  const load = () => { try{ const s = JSON.parse(localStorage.getItem('selectAid:v9')); if(s){ Object.assign(state, s); } }catch(e){} };

  const clearStage = () => stage.innerHTML = '';

  const makeChoice = ({text, sub='', cls=''}) => {
    const btn = document.createElement('button');
    btn.className = `choice ${cls}`;
    btn.innerHTML = `<div>${text}</div>${sub? `<div class=\"sub\">${sub}</div>` : ''}`;
    btn.addEventListener('click', () => onPick(text, sub));
    return btn;
  };

  const renderEditors = () => {
    const isTwoOrThree = (state.pattern === 'marubatsu' || state.pattern === 'yaru');
    edit2.classList.toggle('hidden', !isTwoOrThree);
    edit4.classList.toggle('hidden', !(state.pattern === 'one2four'));
    thirdRow.classList.toggle('hidden', state.pattern !== 'yaru');

    const arr = state.labels2[state.pattern] || null;
    if(arr){
      left2.disabled = right2.disabled = false;
      left2.value = arr[0] ?? '';
      right2.value = arr[1] ?? '';
      third.value = arr[2] ?? '';
      third.disabled = (state.pattern !== 'yaru');
    }else{
      left2.disabled = right2.disabled = third.disabled = true;
      left2.value = right2.value = third.value = '';
    }
    tInputs.forEach((el,i)=>{ el.value = state.labels4[i] || ''; });
  };

  const render = () => {
    renderEditors();
    clearStage();

    if(state.pattern === 'marubatsu'){
      stage.className = 'two';
      const [L,R] = state.labels2[state.pattern];
      const left = makeChoice({text:L, cls:'green'});
      const right = makeChoice({text:R, cls:'red'});
      stage.appendChild(left);
      stage.appendChild(right);
    } else if(state.pattern === 'yaru'){
      stage.className = 'three';
      const [A,B,C] = state.labels2[state.pattern];
      const a = makeChoice({text:A, cls:'green'});
      const b = makeChoice({text:B, cls:'red'});
      const c = makeChoice({text:C, cls:'yellow'});
      [a,b,c].forEach(el => stage.appendChild(el));
    } else {
      stage.className = 'four';
      const labels = state.labels4.slice(0,4).map(s => (s||'').trim());
      const items = [
        makeChoice({text:'ï¼‘', sub: labels[0], cls:'blue'}),
        makeChoice({text:'ï¼’', sub: labels[1], cls:'amber'}),
        makeChoice({text:'ï¼“', sub: labels[2], cls:'green'}),
        makeChoice({text:'ï¼”', sub: labels[3], cls:'red'}),
      ];
      items.forEach(el => stage.appendChild(el));
    }
    save();
  };

  const onPick = (text, sub) => {
    overlayText.innerHTML = sub ? `${text}<span class="small">${sub}</span>` : text;
    overlay.style.display = 'flex';
  };

  patternSel.addEventListener('change', () => { state.pattern = patternSel.value; render(); });
  overlayClose.addEventListener('click', () => overlay.style.display = 'none');
  overlay.addEventListener('click', (e) => { if(e.target === overlay) overlay.style.display = 'none'; });

  left2.addEventListener('input', () => { if(state.labels2[state.pattern]){ state.labels2[state.pattern][0] = left2.value; render(); } });
  right2.addEventListener('input', () => { if(state.labels2[state.pattern]){ state.labels2[state.pattern][1] = right2.value; render(); } });
  third.addEventListener('input', () => { if(state.labels2[state.pattern] && state.pattern==='yaru'){ state.labels2[state.pattern][2] = third.value; render(); } });

  tInputs.forEach((el,idx) => {
    el.addEventListener('input', () => {
      state.labels4[idx] = el.value;
      if(state.pattern === 'one2four') render(); else save();
    });
  });

  // ====== å…¨ç”»é¢è¡¨ç¤º ======
  const enterPresentation = () => { document.body.classList.add('presentation'); save(); };
  const exitPresentation = () => { document.body.classList.remove('presentation'); save(); };
  presentBtn.addEventListener('click', enterPresentation);
  unlockBtn.addEventListener('click', exitPresentation);

  // ====== PWA: Service Worker ç™»éŒ² ======
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js').catch(console.error);
    });
  }

  // ====== PWA: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¿ƒé€²ï¼ˆAndroid Chrome ãªã©ï¼‰ ======
  let deferredPrompt = null;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.hidden = false;
  });
  installBtn?.addEventListener('click', async () => {
    installBtn.disabled = true;
    if (deferredPrompt) {
      deferredPrompt.prompt();
      try { await deferredPrompt.userChoice; } catch (e) {}
      deferredPrompt = null;
    }
    setTimeout(() => { installBtn.hidden = true; installBtn.disabled = false; }, 600);
  });

  const init = () => { load(); patternSel.value = state.pattern; render(); };
  init();
})();
</script>

<!--
==== è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆGitHubã«ä½œæˆã—ã¦ãã ã•ã„ï¼‰====================================
1) manifest.webmanifest
{
  "name": "ã˜ã¶ã‚“ã§ã€ãˆã‚‰ã¼ã†ï¼",
  "short_name": "ãˆã‚‰ã¼ã†",
  "start_url": "./",
  "scope": "./",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#111827",
  "lang": "ja",
  "icons": [
    {"src": "icons/icon-192.png", "sizes": "192x192", "type": "image/png"},
    {"src": "icons/icon-512.png", "sizes": "512x512", "type": "image/png"},
    {"src": "icons/maskable-512.png", "sizes": "512x512", "type": "image/png", "purpose": "maskable"}
  ]
}

2) sw.js ï¼ˆè¶…ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼šHTMLç­‰ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œï¼‰
const CACHE = 'select-aid-v1';
const CORE = ['./'];
self.addEventListener('install', (event) => {
  event.waitUntil((async () => {
    const cache = await caches.open(CACHE);
    await cache.addAll(CORE);
    self.skipWaiting();
  })());
});
self.addEventListener('activate', (event) => {
  event.waitUntil((async () => {
    const keys = await caches.keys();
    await Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)));
    await self.clients.claim();
  })());
});
self.addEventListener('fetch', (event) => {
  const req = event.request;
  if (req.method !== 'GET') return;
  // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒšãƒ¼ã‚¸é·ç§»ï¼‰ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥å„ªå…ˆâ†’å¤±æ•—æ™‚ã¯ãƒãƒƒãƒˆâ†’ãã‚Œã‚‚ãƒ€ãƒ¡ãªã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€å¾Œã®ç‰ˆ
  if (req.mode === 'navigate') {
    event.respondWith((async () => {
      const cache = await caches.open(CACHE);
      const cached = await cache.match('./');
      try {
        const fresh = await fetch(req);
        cache.put('./', fresh.clone());
        return fresh;
      } catch (e) {
        return cached || new Response('<h1>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</h1>', {headers:{'Content-Type':'text/html'}});
      }
    })());
    return;
  }
  // ãã®ä»–ã®GETã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥å„ªå…ˆã® stale-while-revalidate
  event.respondWith((async () => {
    const cache = await caches.open(CACHE);
    const cached = await cache.match(req);
    const network = fetch(req).then(res => { cache.put(req, res.clone()); return res; }).catch(() => null);
    return cached || network || Response.error();
  })());
});

3) ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒï¼ˆä»»æ„ã®ãƒ­ã‚´ã§OK / é€æ˜èƒŒæ™¯æ¨å¥¨ï¼‰
- icons/icon-192.png
- icons/icon-512.png
- icons/maskable-512.pngï¼ˆè§’ãŒåˆ‡ã‚Œãªã„ã‚ˆã†ä¸Šä¸‹å·¦å³ã«ä½™ç™½å¤šã‚ï¼‰

â€» GitHub Pages ã® Settingsâ†’Pages ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€PWAã¨ã—ã¦ãƒ›ãƒ¼ãƒ ç”»é¢è¿½åŠ ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œã§ãã¾ã™ã€‚
========================================================================
-->
</body>
</html>
